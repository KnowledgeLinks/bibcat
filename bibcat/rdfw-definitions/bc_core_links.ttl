@prefix acl: <http://www.w3.org/ns/auth/acl#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix kds: <http://knowledgelinks.io/ns/data-structures/> .
@prefix es: <http://knowledgelinks.io/ns/elasticsearch/> .
@prefix kdr: <http://knowledgelinks.io/ns/data-resources/> .
@prefix obi: <https://w3id.org/openbadges#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <http://schema.org/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix vcard: <http://www.w3.org/2006/vcard/ns#> .
@prefix bf: <http://id.loc.gov/ontologies/bibframe/> .
@prefix dcterm: <http://purl.org/dc/terms/> .
@prefix mads: <http://www.loc.gov/mads/rdf/v1#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .

schema:DataType rdfs:subClassOf rdfs:Literal .
# Adding an overaching class to Bibframe to allow for class wide
# property inheritance
bf:Resource a owl:Class;
	rdfs:label "Resource"^^xsd:string ;
	skos:defintion "Base class for any Bibframe Object"^^xsd:string .

# bf:Work bf:Instance and bf:Item now inherit from bf:Resource
bf:Work rdfs:subClassOf bf:Resource ;
	kds:storageType "object" ;
	kds:esIndex "works" ;
	kds:esDocType "work" ;
	kds:esNestedProps rdfs:label;
	kds:esValue bf:title, bf:hasInstance ;
	kds:esSpecialUnion """UNION {
	# get base triples for bf:Items
	?instance bf:instanceOf ?item .
	?s bf:itemOf ?instance .
	?s ?p ?o .
  } UNION {
	# get 1 level deap for bf:Items
	?instance bf:instanceOf ?item .
	?bf_item bf:itemOf ?instance .
	?bf_item ?p1 ?s .
	?s ?p ?o .
	FILTER(ISBLANK(?s)||ISIRI(?s)) .
	FILTER(?p1!=bf:itemOf).
  } UNION {
	# get 2 level deap for bf:Items
	?instance bf:instanceOf ?item .
	?bf_item bf:itemOf ?instance .
	?bf_item ?p1 ?s1 .
	?s1 ?p2 ?s .
	?s ?p ?o .
	FILTER(ISBLANK(?s1)||ISIRI(?s1))
	FILTER(ISBLANK(?s)||ISIRI(?s)) .
	FILTER(?p1!=bf:itemOf).
  }""" .
bf:Collection kds:storageType "object" ;
	kds:esIndex "collections" ;
	kds:esDocType "collection" .

bf:Instance rdfs:subClassOf bf:Resource ;
	kds:storageType "object" ;
	kds:esValue bf:title ;
	kds:esRmlProcessor [
		a kdr:RmlSPARQLProcessor ;
		kds:esRmlMapping "bf-to-schema_rdfw.ttl" ;
		kds:forceNested true ;
		rdfs:label "schema_json_ld" ;
		kds:rmlProcessorParams [
			kds:rtn_format "json-ld" ;
			kds:subjectKwarg "instance" ;
			a kdr:ParamaterClass
		]
	] .

bf:Item rdfs:subClassOf bf:Resource .
bf:ProvisionActivity rdfs:subClassOf bf:Resource .

bf:GenerationProcess kds:esNestedProps bf:generationDate,
	rdf:value .
# The below properties did not have an associated domain in the bibframe2
# vocab file

bf:Organization rdfs:subClassOf bf:Agent .
bf:Person rdfs:subClassOf bf:Agent .

bf:Agent kds:esIndex "agents" ;
	kds:esDocType "agent" .

bf:coverArt kds:esProcessor [
		kds:appliesToClass kdr:AllClasses ;
		kds:params [
			kds:lookupProperty rdf:value;
			a kdr:ParamaterClass
		] ;
		a kdr:ConvertObjectToStringProcessor
	] .

bf:note rdfs:domain bf:Resource .
bf:date rdfs:domain bf:Resource .
bf:place rdfs:domain bf:Resource .
bf:source rdfs:domain bf:Resource .
rdfs:label rdfs:domain bf:Resource, bf:TableOfContents, bf:Identifier .

bf:summary rdfs:domain bf:Work, bf:Instance .

bf:soundContent rdfs:domain bf:Work, bf:Instance .

bf:issuance rdfs:domain bf:Work, bf:Instance .

bf:title rdfs:domain bf:Work, bf:Instance, bf:Item .

bf:agent rdfs:domain bf:Work, bf:Instance .

bf:contribution rdfs:domain bf:Work, bf:Instance .

bf:subject rdfs:domain bf:Work, bf:Instance, bf:Item ;
	rdfs:range bf:Topic .

bf:partOf rdfs:domain bf:Work, bf:Instance, bf:Item ;
	rdfs:range bf:Work, bf:Instance, bf:Item, bf:Collection .

bf:tableOfContents rdfs:domain bf:Work, bf:Instance .

bf:Role kds:esNestedProps "none"; #	rdfs:label, mads:authoritativeLabel ;
	kds:esValue mads:authoritativeLabel .

bf:Organization kds:esNestedProps rdf:type .

bf:UsageAndAccessPolicy kds:esValue skos:prefLabel ;
	kds:esNestedProps "label" .

bf:hasItem kds:esObjectType kdr:Array ;
	kds:esValue "uri" .
bf:hasInstance kds:esObjectType kdr:Array .
bf:itemOf kds:esObjectType kdr:Array .


rdf:type kds:initProcessor [
		kds:appliesToClass kdr:AllClasses ;
		a kdr:AddClassProcessor
	] ;
	kds:esProcessor	[
		kds:appliesToClass kdr:AllClasses ;
		a kdr:AddClassHierarchyProcessor
	] ;
	kds:rangeDef [
		kds:appliesToClass kdr:AllClasses ;
		kds:appliesToRange kdr:AllClasses ;
		kds:esIndexType es:NotAnalyzed ;
		kds:esValue "uri"
	] .

bf:Collection kds:esValue bf:title .

bf:hasInstance kds:rangeDef [
		kds:appliesToClass kdr:AllClasses ;
		kds:esLookup owl:inverseOf
	] .
bf:instanceOf kds:rangeDef [
		kds:appliesToClass kdr:AllClasses ;
		kds:esIndexType es:Ignored
	] .

bf:hasItem kds:rangeDef [
		kds:appliesToClass kdr:AllClasses ;
		kds:esLookup owl:inverseOf
	] .
bf:itemOf kds:rangeDef [
		kds:appliesToClass kdr:AllClasses ;
		kds:esIndexType es:Ignored
	] .
bf:partOf kds:rangeDef [
		kds:appliesToClass bf:Instance ;
		kds:esIndexClass bf:Collection
	] .

bf:Item kds:storageType "object" ;
	kds:esValue "uri" ;
	kds:esAltValue rdfs:label ;
	kds:esIndex "items" ;
	kds:esDocType "item" ;
	kds:esRmlProcessor [
		a kdr:RmlSPARQLProcessor ;
		kds:esRmlMapping "bf-to-map4.ttl", "map4.ttl";
		rdfs:label "map4_json_ld";
		kds:rmlProcessorParams [
			kds:rtn_format "json-ld" ;
			kds:subjectKwarg "item_iri" ;
			a kdr:ParamaterClass
		]
	] .

bf:expressionOf kds:rangeDef [
	kds:esIndexType: es:Ignored
] .
# bf:identifiedBy rdfs:domain bf:Item ;
# 	kds:rangeDef [
# 		kds:appliesToClass bf:Item ;
# 		kds:appliesToRange bf:Identifier ;
# 		kds:esField rdf:type ;
# 		kds:esValue rdf:value
# 	] .

# ----------------- bf:Topic ---------------------------------------------------
bf:Topic a kds:ControlledClass ;
	kds:storageType "object" ;
	kds:esNestedProps rdfs:label, rdf:type, rdf:value;
	# kds:esNestedProps skos:broader, skos:altLabel, skos:prefLabel,
	# 				  bf:identifiedBy, rdfs:label, rdf:type, rdf:value;
	kds:esValue skos:prefLabel ;
	kds:esAltValue rdfs:label ;
	kds:esIndex "topics" ;
	kds:esDocType "topic" .

rdfs:seeAlso kds:rangeDef [
	kds:appliesToClass kdr:AllClasses ;
	kds:esIndexType es:NotAnalyzed
] .

rdf:value rdfs:domain bf:Topic ;
	kds:rangeDef [
	kds:appliesToClass kdr:AllClasses ;
	kds:esIndexType es:Standard
] .


skos:broader rdfs:domain bf:Topic ;
	rdfs:range bf:Topic ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic ;
		kds:appliesToRange bf:Topic ;
		kds:esIndexType es:Nested
	] .

skos:inScheme rdfs:domain bf:Topic ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic ;
		kds:appliesToRange skos:ConceptScheme  ;
		kds:esIndexType es:NotAnalyzed ;
		kds:esValue "uri"
	] .

skos:member rdfs:domain bf:Topic ;
	rdfs:range xsd:string ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic ;
		kds:appliesToRange xsd:string  ;
		kds:esIndexType es:NotAnalyzed
	] .

dcterm:created rdfs:domain bf:Topic ;
	rdfs:range xsd:datetime ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic ;
		kds:appliesToRange xsd:datetime
	] .

skos:altLabel rdfs:domain bf:Topic ;
	rdfs:range xsd:string ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic;
		kds:appliesToRange xsd:string  ;
		kds:esIndexType es:Standard;
		kds:esIndexType es:Raw;
		kds:esIndexType es:Lower
	] .

skos:notation rdfs:domain bf:Topic ;
	rdfs:range xsd:string ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic ;
		kds:appliesToRange xsd:string
	] .


skos:prefLabel rdfs:domain bf:Topic ;
	rdfs:range xsd:string ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic;
		kds:appliesToRange xsd:string  ;
		kds:esIndexType es:Standard;
		kds:esIndexType es:Raw;
		kds:esIndexType es:Lower
	] .

dcterm:modified rdfs:domain bf:Topic ;
	rdfs:range xsd:datetime ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic ;
		kds:appliesToRange xsd:datetime
	] .

rdf:type rdfs:domain bf:Topic ;
	rdfs:range xsd:string ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic ;
		kds:appliesToRange xsd:string  ;
		kds:esIndexType es:NotAnalyzed;
	] .

bf:identifiedBy rdfs:domain bf:Topic ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic ;
		kds:appliesToRange bf:Identifier ;
		kds:esIndexType es:Nested
	] .

skos:note rdfs:domain bf:Topic ;
	rdfs:range xsd:string ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic ;
		kds:appliesToRange xsd:string  ;
		kds:esIndexType es:Standard;
	] .

skos:example rdfs:domain bf:Topic ;
	rdfs:range xsd:string ;
	kds:rangeDef [
		kds:appliesToClass bf:Topic;
		kds:appliesToRange xsd:string  ;
		kds:esIndexType es:Standard;
	] ;
	rdfs:comment "email address.";
	kds:requiredByDomain skos:example;
	kds:propertyProcessing [
		kds:appliesToClass bf:Topic;
		a kdr:EmailVerificationProcessor
	];
	kds:propertyValidation [
		kds:appliesToClass kdr:AllClasses;
		a kdr:EmailValidator
	];
	kds:propertySecurity [
		kds:appliesToClass kdr:AllClasses;
		acl:agent kdr:self-sg;
		acl:mode acl:Read, acl:Write
	] ;
	kds:formDefault [
		kds:appliesToClass kdr:AllClasses;
		kds:formFieldName "emailaddr";
		kds:formLabelName "Email Address";
		kds:formFieldHelp "Enter a valid email address.";
		kds:fieldType [
			a	kdr:TextField
		]
	] .

